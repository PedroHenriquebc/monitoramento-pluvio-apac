<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Histórico Pluviométrico</title>

    <!-- Estilos personalizados -->
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300&display=swap" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="icons8-rain-48.png">
    <style>
        body {
            font-family: "Quicksand";
            font-weight: 700;
        }

        .select2-container--default .select2-selection--single {
            margin-bottom: 20px;

        }

        .select2-container--open .select2-dropdown--below {
            margin-top: -20px;
        }
    </style>

    <!-- Importação do Select2 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

    <script>
        const mesorregiaoData = {
            agreste: {
                microrregioes: ["Todas", "Alto Capibaribe", "Brejo Pernambucano", "Garanhuns", "Médio Capibaribe", "Vale do Iipojuca", "Vale do Ipanema"],
                bacias: ["Todas", "CAPIBARIBE", "GI1", "GI2", "GI4", "GOIANA", "IPOJUCA", "IPANEMA", "MUNDAÚ", "MOXOTÓ", "SIRINHAÉM", "UNA"],
                municipios: ["Todos", "Agrestina", "Águas Belas", "Alagoinha", "Altinho", "Angelim", "Barra de Guabiraba", "Belo Jardim", "Bezerros", "Bom Conselho", "Bom Jardim", "Bonito", "Brejão", "Brejo da Madre de Deus", "Buíque", "Cachoeirinha", "Caetés",
                    "Calçado", "Camocim de São Félix", "Canhotinho", "Capoeiras", "Caruaru", "Casinhas", "Correntes", "Cumaru", "Cupira", "Feira Nova", "Frei Miguelinho", "Garanhuns", "Gravatá", "Iati",
                    "Ibirajuba", "Itaíba", "Jataúba", "João Alfredo", "Jucati", "Jupi", "Jurema", "Lagoa do Ouro", "Lagoa dos Gatos", "Lajedo", "Limoeiro", "Machados", "Orobó", "Palmeirina", "Panelas",
                    "Paranatama", "Passira", "Pedra", "Pesqueira", "Poção", "Riacho das Almas", "Sairé", "Salgadinho", "Saloá", "Sanharó", "Santa Cruz do Capibaribe", "Santa Maria do Cambucá",
                    "São Bento do Una", "São Caitano", "São João", "São Joaquim do Monte", "São Vicente Férrer", "Surubim", "Tacaimbó", "Taquaritinga do Norte", "Terezinha", "Toritama", "Tupanatinga", "Venturosa", "Vertente do Lério", "Vertentes"]
            },
            mata: {
                microrregioes: ["Todas", "Mata Meridional Pernambucana", "Mata Setentrional Pernambucana", "Vitória de Santo Antão"],
                bacias: ["Todas", "CAPIBARIBE", "GI1", "GI4", "GOIANA", "GL4", "IPOJUCA", "MOXOTÓ", "SIRINHAÉM", "UNA"],
                municipios: ["Todos", "Água Preta", "Aliança", "Amaraji", "Barreiros", "Belém de Maria", "Buenos Aires", "Camutanga", "Carpina", "Catende", "Chã de Alegria", "Chã Grande", "Condado", "Cortês", "Escada", "Ferreiros",
                    "Gameleira", "Glória do Goitá", "Goiana", "Itambé", "Itaquitinga", "Jaqueira", "Joaquim Nabuco", "Lagoa de Itaenga", "Lagoa do Carro", "Macaparana", "Maraial", "Nazaré da Mata",
                    "Palmares", "Paudalho", "Pombos", "Primavera", "Quipapá", "Ribeirão", "Rio Formoso", "São Benedito do Sul", "São José da Coroa Grande", "Sirinhaém", "Tamandaré", "Timbaúba", "Tracunhaém", "Vicência", "Vitória de Santo Antão", "Xexéu"
                ]
            },
            metropolitana: {
                microrregioes: ["Todas", "Fernando de Noronha", "Itamaracá", "Recife", "Suape"],
                bacias: ["Todas", "CAPIBARIBE", "FERNANDO DE NORONHA", "GL1", "GL2", "GI1", "GI2", "IPOJUCA"],
                municipios: ["Todos", "Abreu e Lima", "Araçoiaba", "Cabo de Santo Agostinho", "Camaragibe", "Fernando de Noronha", "Igarassu", "Ipojuca", "Ilha de Itamaracá", "Itapissuma", "Jaboatão dos Guararapes", "Moreno",
                    "Olinda", "Paulista", "Recife", "São Lourenço da Mata"]
            },
            sertao: {
                microrregioes: ["Todas", "Araripina", "Pajeú", "Salgueiro", "Sertão do Moxotó"],
                bacias: ["Todas", "BRÍGIDA", "GI1", "MOXOTÓ", "PAJEÚ", "TERRA NOVA"],
                municipios: ["Todos", "Afogados da Ingazeira", "Araripina", "Arcoverde", "Betânia", "Bodocó", "Brejinho", "Calumbi", "Carnaíba", "Cedro", "Custódia", "Exu", "Flores", "Granito",
                    "Ibimirim", "Iguaracy", "Inajá", "Ingazeira", "Ipubi", "Itapetim", "Manari", "Mirandiba", "Moreilândia", "Ouricuri", "Parnamirim", "Quixaba", "Salgueiro", "Santa Cruz",
                    "Santa Cruz da Baixa Verde", "Santa Filomena", "Santa Terezinha", "São José do Belmonte", "São José do Egito", "Serra Talhada", "Serrita", "Sertânia", "Solidão", "Tabira",
                    "Trindade", "Triunfo", "Tuparetama", "Verdejante"]
            },
            saofrancisco: {
                microrregioes: ["Todas", "Itaparica", "Petrolina"],
                bacias: ["Todas", "BRÍGIDA", "GARÇAS", "GI3", "GI4", "GI6", "GI8", "MOXOTÓ", "PAJEÚ", "PONTAL", "TERRA NOVA"],
                municipios: ["Todos", "Afrânio", "Belém do São Francisco", "Cabrobó", "Carnaubeira da Penha", "Dormentes", "Floresta", "Itacuruba", "Jatobá", "Lagoa Grande", "Orocó", "Petrolândia",
                    "Petrolina", "Santa Maria da Boa Vista", "Tacaratu", "Terra Nova"]
            },
            todas: {
                microrregioes: ["Todas"],
                bacias: ["Todas", "BRÍGIDA", "CAPIBARIBE", "FERNANDO DE NORONHA", "GI1", "GI2", "GI3", "GI4", "GI5", "GI6", "GI7", "GI8", "GI9", "GARÇAS", "GL1", "GL2", "GL3", "GL4", "GL5", "GL6",
                    "GOIANA", "IPOJUCA", "IPANEMA", "MUNDAÚ", "MOXOTÓ", "PAJEÚ", "PONTAL", "RIO BEBERIBE", "RIO PARATIBE", "RIO TIMBÓ", "SIRINHAÉM", "TERRA NOVA", "UNA"],
                municipios: ["Todos", "Abreu e Lima", "Afogados da Ingazeira", "Agrestina", "Água Preta", "Águas Belas", "Alagoinha", "Aliança", "Altinho", "Amaraji",
                    "Angelim", "Araçoiaba", "Araripina", "Arcoverde", "Barra de Guabiraba", "Barreiros", "Belém de Maria", "Belém do São Francisco", "Belo Jardim", "Betânia", "Bezerros", "Bodocó",
                    "Bom Conselho", "Bom Jardim", "Bonito", "Brejão", "Brejinho", "Brejo da Madre de Deus", "Buenos Aires", "Buíque", "Cabo de Santo Agostinho", "Cabrobó", "Cachoeirinha", "Caetés", "Calçado",
                    "Calumbi", "Camaragibe", "Camocim de São Félix", "Camutanga", "Canhotinho", "Capoeiras", "Carnaíba", "Carnaubeira da Penha", "Carpina", "Caruaru", "Casinhas", "Catende", "Cedro",
                    "Chã de Alegria", "Chã Grande", "Condado", "Correntes", "Cortês", "Cumaru", "Cupira", "Custódia", "Afrânio", "Dormentes", "Escada", "Exu", "Feira Nova", "Fernando de Noronha", "Ferreiros",
                    "Flores", "Floresta", "Frei Miguelinho", "Gameleira", "Garanhuns", "Glória do Goitá", "Goiana", "Granito", "Gravatá", "Iati", "Ibimirim", "Ibirajuba", "Igarassu", "Iguaracy", "Inajá",
                    "Ingazeira", "Ipojuca", "Ipubi", "Itacuruba", "Itaíba", "Ilha de Itamaracá", "Itambé", "Itapetim", "Itapissuma", "Itaquitinga", "Jaboatão dos Guararapes", "Jaqueira", "Jataúba", "Jatobá",
                    "João Alfredo", "Joaquim Nabuco", "Jucati", "Jupi", "Jurema", "Lagoa de Itaenga", "Lagoa do Carro", "Lagoa do Ouro", "Lagoa dos Gatos", "Lagoa Grande", "Lajedo", "Limoeiro", "Macaparana",
                    "Machados", "Manari", "Maraial", "Mirandiba", "Moreilândia", "Moreno", "Nazaré da Mata", "Olinda", "Orobó", "Orocó", "Ouricuri", "Palmares", "Palmeirina", "Panelas", "Paranatama",
                    "Parnamirim", "Passira", "Paudalho", "Paulista", "Pedra", "Pesqueira", "Petrolândia", "Petrolina", "Poção", "Pombos", "Primavera", "Quipapá", "Quixaba", "Recife", "Riacho das Almas",
                    "Ribeirão", "Rio Formoso", "Sairé", "Salgadinho", "Salgueiro", "Saloá", "Sanharó", "Santa Cruz", "Santa Cruz da Baixa Verde", "Santa Cruz do Capibaribe", "Santa Filomena",
                    "Santa Maria da Boa Vista", "Santa Maria do Cambucá", "Santa Terezinha", "São Benedito do Sul", "São Bento do Una", "São Caitano", "São João", "São Joaquim do Monte",
                    "São José da Coroa Grande", "São José do Belmonte", "São José do Egito", "São Lourenço da Mata", "São Vicente Férrer", "Serra Talhada", "Serrita", "Sertânia", "Sirinhaém",
                    "Solidão", "Surubim", "Tabira", "Tacaimbó", "Tacaratu", "Tamandaré", "Taquaritinga do Norte", "Terezinha", "Terra Nova", "Timbaúba", "Toritama", "Tracunhaém", "Trindade", "Triunfo", "Tupanatinga",
                    "Tuparetama", "Venturosa", "Verdejante", "Vertente do Lério", "Vertentes", "Vicência", "Vitória de Santo Antão", "Xexéu"
                ]

            }
        }

        function validarDatas() {
            const dataInicial = document.getElementById("dataInicial").value;
            const dataFinal = document.getElementById("dataFinal").value;
            const anoInicial = new Date(dataInicial).getFullYear();
            const anoFinal = new Date(dataFinal).getFullYear();

            // Verifica se a data final é menor que a data inicial
            if (new Date(dataFinal) < new Date(dataInicial)) {
                alert("A data final deve ser maior ou igual à data inicial.");
                return false;
            }

            // Verifica se o ano é menor que 2024
            if (anoInicial < 2024 || anoFinal < 2024) {
                alert("O ano deve ser maior ou igual a 2024.");
                return false;
            }
            return true;
        }

        function redirecionarForm() {
            console.log("Entrei no redirecionar form");
            var formulario = document.getElementById('formulario');
            const tipoBoletim = document.querySelector('input[name="tipoBoletim"]:checked').value;
            // Definir a ação do formulário com base no valor do campo de rádio
            if (tipoBoletim === 'Diário') {
                formulario.action = 'diario.php';
            } else {
                formulario.action = 'mensal.php';
            }

            formulario.submit();
        }

        // Função para atualizar dinamicamente as opções
        function updateSelections() {
            let mesorregiao = document.getElementById('mesorregiao').value;
            switch (mesorregiao) {
                case "Agreste Pernambucano":
                    mesorregiao = "agreste";
                    break;
                case "Mata Pernambucana":
                    mesorregiao = "mata";
                    break;
                case "Metropolitana de Recife":
                    mesorregiao = "metropolitana";
                    break;
                case "Sertão Pernambucano":
                    mesorregiao = "sertao";
                    break;
                case "São Francisco Pernambucano":
                    mesorregiao = "saofrancisco";
                    break;
                case "Todas":
                    mesorregiao = "todas";
                    break;
            }

            const microrregiaoSelect = document.getElementById('microrregiao');
            const baciaSelect = document.getElementById('bacia');
            const municipioSelect = document.getElementById('municipio');

            microrregiaoSelect.innerHTML = '';
            baciaSelect.innerHTML = '';
            municipioSelect.innerHTML = '';

            mesorregiaoData[mesorregiao].microrregioes.forEach(microrregiao => {
                const option = document.createElement('option');
                option.textContent = microrregiao;
                microrregiaoSelect.appendChild(option);
            });

            mesorregiaoData[mesorregiao].bacias.forEach(bacia => {
                const option = document.createElement('option');
                option.textContent = bacia;
                baciaSelect.appendChild(option);
            });

            mesorregiaoData[mesorregiao].municipios.forEach(municipio => {
                const option = document.createElement('option');
                option.textContent = municipio;
                municipioSelect.appendChild(option);
            });
        }

        function toggleDataFinal() {
            const dataFinalLabel = document.getElementById('dataFinalLabel');
            const dataFinal = document.getElementById('dataFinal');
            const radioMensal = document.getElementById('mensal');
            const radioDiario = document.getElementById('diario');
            const message = document.getElementById('message');

            if (radioMensal.checked) {
                dataFinalLabel.style.display = 'block';
                dataFinal.style.display = 'block';
                dataFinal.required = true;
                message.style.display = 'block';
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            const radios = document.getElementsByName('tipoBoletimPeriodo');
            radios.forEach(radio => {
                radio.addEventListener('change', toggleDataFinal);
            });

            toggleDataFinal();
        });

        window.onload = function () {
            updateSelections();
        };
    </script>
</head>

<body>
    <div class="container">
        <img src="logo3_apac_2024.png" alt="Logo">
        <h1>Histórico Pluviométrico</h1>
        <form method="POST" action="" id="formulario">
            <label for="mesorregiao">Mesorregião</label>
            <select id="mesorregiao" name="mesorregiao" onchange="updateSelections()">
                <option value="Todas">Todas</option>
                <option value="Agreste Pernambucano">Agreste Pernambucano</option>
                <option value="Mata Pernambucana">Mata Pernambucana</option>
                <option value="Metropolitana de Recife">Metropolitana de Recife</option>
                <option value="Sertão Pernambucano">Sertão Pernambucano</option>
                <option value="São Francisco Pernambucano">São Francisco Pernambucano</option>
            </select>

            <label for="microrregiao">Microrregião</label>
            <select id="microrregiao" name="microrregiao"></select>

            <label for="municipio">Município</label>
            <select id="municipio" name="municipio"></select>

            <label for="bacia">Bacia</label>
            <select id="bacia" name="bacia"></select>

            <input type="radio" id="mensal" name="tipoBoletim" value="Mensal" checked="checked">
            <label for="mensal">Mensal</label>
            <input type="radio" id="diario" name="tipoBoletim" value="Diário">
            <label for="diario">Diário</label>
            <br>

            <label for="dataInicial">Data Inicial</label>
            <input type="date" id="dataInicial" name="dataInicial" required>

            <label for="dataFinal" id="dataFinalLabel" style="display:none;">Data Final</label>
            <input type="date" id="dataFinal" name="dataFinal" style="display:none;">

            <p id="message" style="display:none; color: rgb(0, 0, 0);"></p>

            <!-- <button type="submit">Gerar</button> -->

            <div class="button-container">
                <button type="button" onclick=" if (validarDatas()) {redirecionarForm();}" class="cssbuttons-io-button">
                    Gerar
                    <div class="icon">
                        <svg height="24" width="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M0 0h24v24H0z" fill="none"></path>
                            <path d="M16.172 11l-5.364-5.364 1.414-1.414L20 12l-7.778 7.778-1.414-1.414L16.172 13H4v-2z"
                                fill="currentColor"></path>
                        </svg>
                    </div>
                </button>
            </div>

        </form>
    </div>
    <!-- Importação do jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Importação do Select2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <script>
        $(document).ready(function () {
            // Inicializando os selects com Select2
            $('#mesorregiao, #microrregiao, #bacia, #municipio').select2({
                placeholder: 'Selecione uma opção',
                allowClear: true
            });

            $(document).on('select2:open', () => {
                document.querySelector('.select2-search__field').focus();
            });
        });
    </script>

</body>

</html>